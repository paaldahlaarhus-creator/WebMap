[
  {
    "objectID": "pages/Oslofjord.html",
    "href": "pages/Oslofjord.html",
    "title": "Oslofjorden",
    "section": "",
    "text": "library(here)\n\nhere() starts at /Users/paal1205/Documents/DataScience/WebMap\n\nlibrary(qs)\n\nqs 0.27.3. Announcement: https://github.com/qsbase/qs/issues/103\n\nlibrary(sf)\n\nLinking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE\n\nlibrary(leaflet)\nlibrary(htmltools)\nlibrary(dplyr)\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\n# helper: load qs if available, fallback to geojson\nread_map &lt;- function(qs_path, geojson_path) {\n  if (file.exists(qs_path)) {\n    tryCatch(\n      qs::qread(qs_path),\n      error = function(e) {\n        message(\"Could not read .qs, using GeoJSON instead.\")\n        st_read(geojson_path, quiet = TRUE)\n      }\n    )\n  } else {\n    st_read(geojson_path, quiet = TRUE)\n  }\n}\n\n# load kommuner\nkomm_qs  &lt;- here(\"data\", \"kommuner.qs\")\nkomm_geo &lt;- here(\"www\", \"assets\", \"kommuner.geojson\")\nkommuner &lt;- read_map(komm_qs, komm_geo)\n\n# ensure CRS\nif (is.na(st_crs(kommuner))) st_crs(kommuner) &lt;- 4258\nkommuner &lt;- st_transform(kommuner, 4326)\n\n# choose name column\nlab_komm &lt;- names(kommuner)[grepl(\"kommunenavn\", names(kommuner), ignore.case = TRUE)][1]\n\n# Oslofjord municipalities using correct names\noslofjord_names &lt;- c(\n  \"Oslo\",\"Bærum\",\"Asker\",\"Nesodden\",\"Frogn\",\"Ås\",\"Vestby\",\"Moss\",\n  \"Fredrikstad\",\"Hvaler\",\"Tønsberg\",\"Horten\",\"Larvik\",\"Sandefjord\",\n  \"Færder\"\n)\n\n# filter\nof_komm &lt;- kommuner |&gt; filter(get(lab_komm) %in% oslofjord_names)\n\n# build map\nleaflet(of_komm) %&gt;%\n  addProviderTiles(providers$CartoDB.Positron) %&gt;%\n  addPolygons(\n    color = \"#2166ac\",\n    fillOpacity = 0.4,\n    weight = 1,\n    label = ~ get(lab_komm)\n  ) %&gt;%\n  setView(lng = 10.5, lat = 59.2, zoom = 9)"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Laster inn nødvendige pakker",
    "section": "",
    "text": "Laster inn nødvendige pakker\nlibrary(here) library(qs) library(sf) library(leaflet) library(htmltools)\n\n\nHjelpefunksjon: prøv å lese .qs (raskt), fall tilbake til GeoJSON (tregere)\nles_kartdata &lt;- function(sti_qs, sti_geosjon) { if (file.exists(sti_qs)) { tryCatch(qs::qread(sti_qs), error = function(e) { message(“Kunne ikke lese”, qs_path, ” (“, e$message,”). Leser GeoJSON i stedet.”) st_read(sti_geojson, quiet = TRUE) }) } else if (file.exists(sti_geojson)) { message(“Fant ikke .qs. Leser rå GeoJSON.”) st_read(sti_geojson, quiet = TRUE) } else { stop(“Fant verken”, sti_qs, ” eller “, sti_geojson,”.”) } }\n\n\nFilstier til kartdata\nsti_kommuner_qs &lt;- here(“data”, “kommuner.qs”) sti_fylker_qs &lt;- here(“data”, “fylker.qs”) sti_kommuner_geojson &lt;- here(“www”, “assets”, “kommuner.geojson”) sti_fylker_geojson &lt;- here(“www”, “assets”, “fylker.geojson”)\n\n\nLeser inn kommune- og fylkesdata\nkommunedata &lt;- les_kartdata(sti_kommuner_qs, sti_kommuner_geojson) fylkesdata &lt;- les_kartdata(sti_fylker_qs, sti_fylker_geojson)\n\n\nSørger for at kartdata har kjent koordinatsystem, og konverter til WGS84 (EPSG:4328)\nif (is.na(st_crs(kommunedata))) st_crs(kommunedata) &lt;- 4258 if (is.na(st_crs(fylkesdata))) st_crs(fylkesdata) &lt;- 4258\nkommunedata &lt;- st_transform(kommunedata, 4326) fylkesdata &lt;- st_transform(fylkesdata, 4326)\n\n\nFinn kolonnen som inneholder kommunenavn/fylkesnavn\nfinn_navnekolonne &lt;- function(df) { kolonnenavn &lt;- names(df) kandidater &lt;- kolonnenavn[ grepl(“navn|name|kommunenavn|administrativenhetnavn”, kolonnenavn, ignore.case = TRUE) ] if (length(kandidater) &gt; 0) { return(kandidater[1]) }\nkolonne_kommunenavn &lt;- finn_navnekolonne(kommunedata) kolonne_fylkesnavn &lt;- finn_navnekolonne(fylkesdata)\n\n\nLag popup-tekst (HTML-sikret)\nlag_popuptekst &lt;- function(df, kolonne) { htmlEscape(as.character(df[[kolonne]])) }\npopup_kommuner &lt;- lag_popup_tekst(kommunedata, kolonnenavn_kommunenavn) popup_fylker &lt;- lag_popuptekst(fylkesdata, kolonne_fylkesnavn)\n\n\nFarger til fylker og kommuner\nfarge_fylke &lt;- “#D73027”\nfarge_kommuner &lt;- “#4575B4”\n\n\nStandard startposisjon for kartet\nstart_latitude &lt;- 64 start_longitude &lt;- 12 start_zoom &lt;- 5\n\n\nBygg leaflet-kart\nkart &lt;- leaflet(options = leafletOptions(zoomControl = TRUE)) %&gt;% addProviderTiles(providers$CartoDB.Positron, group = “Bakgrunnskart”) %&gt;%\n# Fylkesgrenser addPolygons( data = fylkesdata, color = farge_fylker, weight = 1, fillOpacity = 0.25, label = ~ htmltools::HTML(paste0(“”, htmlEscape(get(kolonne_fylkesnavn)), “”)), popup = ~ popup_fylker, group = “Fylker”, highlight = highlightOptions(weight = 3, bringToFront = TRUE) ) %&gt;%\n# Kommunegrenser addPolygons( data = kommunedata, color = farge_kommuner, weight = 0.8, fillOpacity = 0.35, label = ~ htmltools::HTML(paste0(htmlEscape(get(kolonne_kommunenavn)))), popup = ~ popup_kommuner, group = “Kommuner”, highlight = highlightOptions(weight = 3, bringToFront = TRUE) ) %&gt;%\n# Lagvelger for å slå av/på lag addLayersControl( baseGroups = c(“Bakgrunnskart”), overlayGroups = c(“Fylker”, “Kommuner”), options = layersControlOptions(collapsed = FALSE) ) %&gt;%\n# Startvisning på kartet setView(lng = start_longitude, lat = start_latitude, zoom = start_zoom)\nkart"
  },
  {
    "objectID": "pages/kommunekart.html",
    "href": "pages/kommunekart.html",
    "title": "Fylker og kommuner",
    "section": "",
    "text": "library(here)\n\nhere() starts at /Users/paal1205/Documents/DataScience/WebMap\n\nlibrary(qs)\n\nqs 0.27.3. Announcement: https://github.com/qsbase/qs/issues/103\n\nlibrary(sf)\n\nLinking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE\n\nlibrary(leaflet)\nlibrary(htmltools)\n\n# Optional local image (change to a file in www/assets if you add it there)\nsite_image &lt;- \"/mnt/data/Screenshot 2025-11-12 at 18.55.31.png\"\n\n# helper to read fast .qs or fallback to GeoJSON\nread_map &lt;- function(qs_path, geojson_path) {\n  if (file.exists(qs_path)) {\n    tryCatch(qs::qread(qs_path),\n             error = function(e) {\n               message(\"Failed to read \", qs_path, \" (\", e$message, \"). Falling back to GeoJSON.\")\n               st_read(geojson_path, quiet = TRUE)\n             })\n  } else if (file.exists(geojson_path)) {\n    message(\"Preprocessed .qs not found; reading raw GeoJSON (this may be slow).\")\n    st_read(geojson_path, quiet = TRUE)\n  } else {\n    stop(\"Neither \", qs_path, \" nor \", geojson_path, \" exist.\")\n  }\n}\n\n# paths\nkommuner_qs &lt;- here(\"data\",\"kommuner.qs\")\nfylker_qs   &lt;- here(\"data\",\"fylker.qs\")\nkommuner_geo &lt;- here(\"www\",\"assets\",\"kommuner.geojson\")\nfylker_geo   &lt;- here(\"www\",\"assets\",\"fylker.geojson\")\n\n# load\nkommuner &lt;- read_map(kommuner_qs, kommuner_geo)\nfylker   &lt;- read_map(fylker_qs,   fylker_geo)\n\n# ensure CRS 4326 (WGS84)\nif (is.na(st_crs(kommuner))) st_crs(kommuner) &lt;- 4258\nif (is.na(st_crs(fylker)))   st_crs(fylker)   &lt;- 4258\nkommuner &lt;- st_transform(kommuner, 4326)\nfylker   &lt;- st_transform(fylker,   4326)\n\n# helper to pick label column\npick_label &lt;- function(x) {\n  nm &lt;- names(x)\n  cand &lt;- nm[grepl(\"navn|name|kommunenavn|administrativenhetnavn\", nm, ignore.case = TRUE)]\n  if (length(cand)) return(cand[1])\n  nm[1]\n}\nlab_komm &lt;- pick_label(kommuner)\nlab_fylk &lt;- pick_label(fylker)\n\n# popup helper\npopup_html &lt;- function(df, labcol) {\n  vals &lt;- as.character(df[[labcol]])\n  vapply(vals, htmlEscape, FUN.VALUE = character(1))\n}\n\nkomm_popup &lt;- popup_html(kommuner, lab_komm)\nfylk_popup &lt;- popup_html(fylker, lab_fylk)\n\n# colors\ncol_fylke &lt;- \"#d73027\"\ncol_komm  &lt;- \"#4575b4\"\n\n# build map with layers control\nleaflet(options = leafletOptions(zoomControl = TRUE)) %&gt;%\n  addProviderTiles(providers$CartoDB.Positron, group = \"Bakgrunn\") %&gt;%\n  addPolygons(\n    data = fylker,\n    group = \"Fylker\",\n    color = col_fylke,\n    weight = 1,\n    fillOpacity = 0.25,\n    label = ~ htmltools::HTML(paste0(\"&lt;b&gt;\", htmlEscape(get(lab_fylk)), \"&lt;/b&gt;\")),\n    popup = ~ fylk_popup,\n    highlight = highlightOptions(weight = 3, bringToFront = TRUE)\n  ) %&gt;%\n  addPolygons(\n    data = kommuner,\n    group = \"Kommuner\",\n    color = col_komm,\n    weight = 0.8,\n    fillOpacity = 0.35,\n    label = ~ htmltools::HTML(htmlEscape(get(lab_komm))),\n    popup = ~ komm_popup,\n    highlight = highlightOptions(weight = 3, bringToFront = TRUE)\n  ) %&gt;%\n  addLayersControl(\n    baseGroups = c(\"Bakgrunn\"),\n    overlayGroups = c(\"Fylker\", \"Kommuner\"),\n    options = layersControlOptions(collapsed = FALSE)\n  )\n\nInput to asJSON(keep_vec_names=TRUE) is a named vector. In a future version of jsonlite, this option will not be supported, and named vectors will be translated into arrays instead of objects. If you want JSON object output, please use a named list instead. See ?toJSON.\n\n\nInput to asJSON(keep_vec_names=TRUE) is a named vector. In a future version of jsonlite, this option will not be supported, and named vectors will be translated into arrays instead of objects. If you want JSON object output, please use a named list instead. See ?toJSON."
  },
  {
    "objectID": "WebMap/index.html",
    "href": "WebMap/index.html",
    "title": "Kart: fylker og kommuner",
    "section": "",
    "text": "library(sf)\n\nLinking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE\n\nlibrary(leaflet)\nlibrary(htmlwidgets)\n\n# Paths to geojson files\nkommuner_path &lt;- \"www/assets/kommuner.geojson\"\nfylker_path   &lt;- \"www/assets/fylker.geojson\"\n\n# Read data\nfylker &lt;- st_read(fylker_path, quiet = FALSE)\n\nMultiple layers are present in data source /Users/paal1205/Documents/DataScience/WebMap/WebMap/www/assets/fylker.geojson, reading layer `Fylke'.\nUse `st_layers' to list all layer names and their type in a data source.\nSet the `layer' argument in `st_read' to read a particular layer.\n\n\nWarning in CPL_read_ogr(dsn, layer, query, as.character(options), quiet, :\nautomatically selected the first layer in a data source containing more than\none.\n\n\nReading layer `Fylke' from data source \n  `/Users/paal1205/Documents/DataScience/WebMap/WebMap/www/assets/fylker.geojson' \n  using driver `GeoJSON'\nSimple feature collection with 15 features and 14 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -99551.21 ymin: 6426048 xmax: 1121941 ymax: 7962744\nProjected CRS: ETRS89 / UTM zone 33N\n\nkommuner &lt;- st_read(kommuner_path, quiet = FALSE)\n\nReading layer `Kommune' from data source \n  `/Users/paal1205/Documents/DataScience/WebMap/WebMap/www/assets/kommuner.geojson' \n  using driver `GeoJSON'\nSimple feature collection with 357 features and 14 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 4.087524 ymin: 57.759 xmax: 31.76159 ymax: 71.38488\nGeodetic CRS:  ETRS89\n\n# Fix CRS\nif (is.na(st_crs(fylker))) st_crs(fylker) &lt;- 4258\nif (is.na(st_crs(kommuner))) st_crs(kommuner) &lt;- 4258\nfylker &lt;- st_transform(fylker, 4326)\nkommuner &lt;- st_transform(kommuner, 4326)\n\n# Find label columns\nlabel_fylke &lt;- names(fylker)[grep(\"navn|name\", names(fylker), ignore.case = TRUE)][1]\nlabel_kommune &lt;- names(kommuner)[grep(\"navn|name\", names(kommuner), ignore.case = TRUE)][1]\n\n# Fallback\nif (is.na(label_fylke)) label_fylke &lt;- names(fylker)[1]\nif (is.na(label_kommune)) label_kommune &lt;- names(kommuner)[1]\n\nleaflet() %&gt;%\n  addTiles() %&gt;%\n  addPolygons(\n    data = fylker,\n    group = \"fylker\",\n    label = ~ get(label_fylke),\n    color = \"red\",\n    weight = 1,\n    fillOpacity = 0.2\n  ) %&gt;%\n  addPolygons(\n    data = kommuner,\n    group = \"kommuner\",\n    label = ~ get(label_kommune),\n    color = \"blue\",\n    weight = 1,\n    fillOpacity = 0.3\n  ) %&gt;%\n  addLayersControl(\n    overlayGroups = c(\"fylker\", \"kommuner\"),\n    options = layersControlOptions(collapsed = FALSE)\n  )"
  }
]